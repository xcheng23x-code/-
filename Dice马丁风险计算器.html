<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Stake Dice 马丁格尔模拟器</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root {
        --primary: #00b300;
        --primary-dark: #009900;
        --danger: #d32f2f;
        --success: #1b5e20;
        --bg: #f9f9f9;
        --card: #ffffff;
        --border: #ddd;
        --text: #1a1a1a;
        --gray: #666;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
        padding: 20px;
    }
    .container {
        max-width: 960px;
        margin: auto;
        background: var(--card);
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    header {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        text-align: center;
        padding: 20px;
        font-size: 1.5rem;
        font-weight: 600;
    }
    .form-section {
        padding: 24px;
        display: grid;
        gap: 16px;
    }
    label {
        font-weight: 600;
        color: #333;
        font-size: 0.95rem;
    }
    input {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 1rem;
        transition: border 0.2s;
    }
    input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(0,179,0,0.2);
    }
    .btn {
        margin-top: 20px;
        padding: 14px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
        width: 100%;
    }
    .btn:hover { background: var(--primary-dark); transform: translateY(-1px); }
    #result {
        padding: 24px;
        background: var(--card);
    }
    .summary {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
        margin-bottom: 16px;
        font-size: 0.95rem;
    }
    .summary p {
        background: #f0f7f0;
        padding: 10px;
        border-radius: 8px;
        font-weight: 500;
        text-align: center;
    }
    .warning {
        background: #fff3cd;
        color: #856404;
        padding: 14px;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
        margin: 16px 0;
        font-weight: 600;
        text-align: center;
    }
    .risk {
        background: #ffebee;
        color: var(--danger);
        padding: 14px;
        border-radius: 8px;
        border-left: 4px solid var(--danger);
        margin: 16px 0;
        font-weight: 600;
        text-align: center;
    }
    .table-container {
        overflow-x: auto;
        border-radius: 8px;
        border: 1px solid var(--border);
        margin-top: 16px;
    }
    .table-container::-webkit-scrollbar { height: 10px; }
    .table-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    .table-container::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
    .table-container::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    table {
        width: 100%;
        min-width: 800px;
        border-collapse: collapse;
        font-size: 0.9rem;
    }
    th {
        background: #f0f0f0;
        font-weight: 600;
        padding: 12px 8px;
        text-align: center;
        border-bottom: 2px solid var(--border);
        white-space: nowrap;
    }
    td {
        padding: 10px 8px;
        text-align: right;
        border-bottom: 1px solid var(--border);
        white-space: nowrap;
    }
    .profit-positive { background: #e8f5e8 !important; }
    .profit-positive td { color: var(--success); font-weight: 600; }
    .bust-row { background: #ffebee !important; }
    .bust-row td { color: var(--danger); font-weight: 600; }
    @media (max-width: 600px) {
        .summary { grid-template-columns: 1fr; }
        table { font-size: 0.8rem; }
        th, td { padding: 8px 4px; }
    }
</style>
</head>
<body>
<div class="container">
    <header>Stake Dice 马丁格尔风险计算器</header>

    <div class="form-section">
        <label>账户余额</label>
        <input type="number" id="balance" step="0.00000001" placeholder="如: 100.00000000">

        <label>基础投注额</label>
        <input type="number" id="baseBet" step="0.00000001" placeholder="如: 1.00000000">

        <label>获胜几率 (%)（0.01~98）</label>
        <input type="number" id="chance" step="0.01" min="0.01" max="98" placeholder="如: 25">

        <label>输后增加投注 (%)（如 100 表示翻倍）</label>
        <input type="number" id="increase" step="0.01" placeholder="如: 50">

        <label>显示行数（默认显示到爆仓行）</label>
        <input type="number" id="displayRows" min="1" max="1000" placeholder="不填则默认值">

        <button class="btn" onclick="calculate()">开始计算</button>
    </div>

    <div id="result"></div>
</div>

<script>
function calculate() {
    const balance = parseFloat(document.getElementById('balance').value) || 0;
    const baseBet = parseFloat(document.getElementById('baseBet').value) || 0;
    let chanceInput = parseFloat(document.getElementById('chance').value) || 0;
    const userIncreasePercent = parseFloat(document.getElementById('increase').value) || 100;
    const userIncrease = userIncreasePercent / 100;
    const displayRowsInput = document.getElementById('displayRows').value.trim();
    const displayRows = displayRowsInput === '' ? null : parseInt(displayRowsInput) || 100;

    // 输入验证
    if (balance <= 0 || baseBet <= 0 || chanceInput < 0.01 || chanceInput > 98 || userIncreasePercent < 0) {
        document.getElementById('result').innerHTML = '<div class="warning">请输入有效数值！（胜率 0.01~98）</div>';
        return;
    }

    // 限制胜率
    if (chanceInput < 0.01) chanceInput = 0.01;
    if (chanceInput > 98) chanceInput = 98;

    const chance = chanceInput / 100;
    const lossChance = 1 - chance;
    const payout = 99 / chanceInput;

    // 计算最大连输次数（可承受）
    let totalBet = 0;
    let bet = baseBet;
    let maxStreak = 0;
    while (totalBet + bet <= balance && bet > 0) {
        totalBet += bet;
        bet *= (1 + userIncrease);
        maxStreak++;
        if (bet > 1e20) break;
    }

    // 回本最小加注 + 0.02% 缓冲
    const minMultiplier = payout / (payout - 1);
    const minIncreasePercent = (minMultiplier - 1) * 100;
    const safeIncreasePercent = minIncreasePercent + 0.02;

    // 生成数据
    const rows = [];
    bet = baseBet;
    totalBet = 0;

    for (let i = 1; i <= 1000; i++) {
        totalBet += bet;
        const profit = bet * payout - bet;
        const netProfit = profit - (totalBet - bet);
        const prob = Math.pow(lossChance, i) * 100;

        rows.push({
            loss: i,
            betAmount: bet,
            totalBet: totalBet,
            profit: profit,
            netProfit: netProfit,
            probability: prob
        });

        bet *= (1 + userIncrease);

        if (i >= 1000) break;
    }

    // 显示行数（默认到 maxStreak）
    const defaultDisplayRows = maxStreak;
    const finalDisplayRows = displayRows !== null ? Math.min(displayRows, rows.length) : defaultDisplayRows;
    const displayData = rows.slice(0, finalDisplayRows);

    // 输出结果
    let html = `
        <div class="summary">
            <p><strong>获胜几率：</strong> ${chanceInput.toFixed(2)}%</p>
            <p><strong>赔率：</strong> ${payout.toFixed(2)}x</p>
            <p><strong>庄家优势：</strong> 1%</p>
        </div>

        <div class="warning">
            您必须每次输后增加 <strong>${safeIncreasePercent.toFixed(8)}%</strong> 才能覆盖损失。
        </div>

        <div class="risk">
            最大可承受 <strong>${maxStreak}</strong> 次连输，最大爆仓概率：<strong>${(Math.pow(lossChance, maxStreak) * 100).toFixed(8)}%</strong>
        </div>
    `;

    // 表格
    html += `
        <div class="table-container">
            <table>
                <tr>
                    <th>连输次数</th>
                    <th>当轮投注</th>
                    <th>累计投注</th>
                    <th>赢得金额</th>
                    <th>净利润</th>
                    <th>最大连输概率</th>
                </tr>`;

    displayData.forEach((r, index) => {
        const rowNum = index + 1;
        let rowClass = '';

        if (rowNum < maxStreak) {
            rowClass = 'profit-positive';  // 1 ~ maxStreak-1：绿色
        } else if (rowNum === maxStreak) {
            rowClass = 'bust-row';         // 第 maxStreak 行：红色（爆仓前最后一次）
        }
        // 如果超过 maxStreak，不显示任何颜色（普通行）

        html += `<tr class="${rowClass}">
            <td>${r.loss}</td>
            <td>${r.betAmount.toFixed(8)}</td>
            <td>${r.totalBet.toFixed(8)}</td>
            <td>${r.profit.toFixed(8)}</td>
            <td>${r.netProfit.toFixed(8)}</td>
            <td>${r.probability.toFixed(8)}%</td>
        </tr>`;
    });
    html += `</table></div>`;

    document.getElementById('result').innerHTML = html;
}
</script>
</body>
</html>

